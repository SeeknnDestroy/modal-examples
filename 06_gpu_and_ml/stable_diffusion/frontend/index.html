<html>
  <head>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Modal - SD XL 1.0</title>
  </head>
  <body x-data="state()">
    <div class="max-w-3xl mx-auto pt-4 pb-8 px-10 sm:py-12 sm:px-6 lg:px-8">
      <h2 class="text-3xl font-medium text-center mb-10">
        SDXL Lightning on Modal
      </h2>

      <form
        class="flex items-center justify-center gap-x-4 gap-y-2 w-full mx-auto mb-4"
      >
        <input
            x-model="prompt"
            x-init="$nextTick(() => { $el.focus(); submitPrompt(); });"
            x-on:input.throttle.200ms="submitPrompt()"
          type="text"
          class="flex w-full px-3 py-3 text-md bg-white border rounded-md border-neutral-300 ring-offset-background placeholder:text-neutral-500 focus:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-400 disabled:cursor-not-allowed disabled:opacity-50 text-center"
        />
      </form>

      <div class="mx-auto w-full max-w-[768px] relative grid">
        <div
          style="padding-top: 100%"
          x-show="loading"
          class="absolute w-full h-full animate-pulse bg-neutral-100 rounded-md"
        ></div>
        <img
          x-show="imageURL"
          class="rounded-md self-center justify-self-center"
          :src="imageURL"
        />
      </div>
    </div>

    <script>
      function state() {
        return {
          prompt: "A cinematic shot of a baby racoon wearing an intricate italian priest robe.",
          features: [],
          imageURL: "",
          async submitPrompt() {
            if (!this.prompt) return;
            const res = await fetch(`{{ inference_url }}?prompt=${this.prompt}`);

            const blob = await res.blob();
            this.imageURL = URL.createObjectURL(blob);
            console.log(this.imageURL);
          },
        };
      }
    </script>
  </body>
</html>
